name: ðŸŒ± Weekly Growth â€” SEED + README + Archive + Outreach
on:
  schedule:
    - cron: '0 10 * * 0'   # Every Sunday 10am UTC
  workflow_dispatch:

jobs:
  grow:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with: {python-version: '3.11'}

      - name: Generate SEED.json â€” organism DNA
        run: python mycelium/generate_seed.py

      - name: Update Living READMEs â€” real numbers
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: python mycelium/living_readme.py

      - name: Archive all live pages to Internet Archive
        run: |
          pages=(
            "https://meekotharaccoon-cell.github.io/meeko-nerve-center/spawn.html"
            "https://meekotharaccoon-cell.github.io/meeko-nerve-center/SYSTEM_STATUS.md"
            "https://meekotharaccoon-cell.github.io/gaza-rose-gallery"
            "https://meekotharaccoon-cell.github.io/gaza-rose-gallery/claim.html"
            "https://meekotharaccoon-cell.github.io/mycelium-knowledge"
            "https://github.com/meekotharaccoon-cell/meeko-nerve-center/blob/main/LICENSE"
            "https://github.com/meekotharaccoon-cell/meeko-nerve-center/blob/main/IMMORTALITY.md"
          )
          for url in "${pages[@]}"; do
            echo "Archiving: $url"
            curl -s -o /dev/null -w "  Status: %{http_code}\n" \
              "https://web.archive.org/save/$url" \
              -H "User-Agent: Mycelium-Archive-Bot/1.0"
            sleep 8
          done

      - name: Send weekly tech outreach (brain-gated)
        env:
          GMAIL_APP_PASSWORD: ${{ secrets.GMAIL_APP_PASSWORD }}
        run: EMAIL_MODE=tech python mycelium/unified_emailer.py || true

      - name: Send grant outreach (brain-gated)
        env:
          GMAIL_APP_PASSWORD: ${{ secrets.GMAIL_APP_PASSWORD }}
        run: EMAIL_MODE=grants python mycelium/unified_emailer.py || true

      - name: Commit everything
        run: |
          git config user.email "meekotharaccoon@gmail.com"
          git config user.name "Mycelium Growth Engine"
          git add data/ || true
          git diff --staged --quiet || git commit -m "ðŸŒ± weekly growth â€” seed + archive + $(date -u +%Y-%m-%d)"
          git push || true
