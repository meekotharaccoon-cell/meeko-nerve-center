name: ðŸ”„ Feedback Loop
# ðŸš¨ SCHEDULES DISABLED â€” Email system rebuild in progress

on:
  workflow_dispatch:

jobs:
  loop:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - name: Configure git
        run: |
          git config user.name 'solarpunk-feedback-loop'
          git config user.email 'loop@meeko-nerve-center'
      - name: Step 1 â€” Signal Tracker
        env:
          MASTODON_TOKEN: ${{ secrets.MASTODON_TOKEN }}
          MASTODON_URL: ${{ secrets.MASTODON_URL }}
          MASTODON_BASE_URL: ${{ secrets.MASTODON_BASE_URL }}
        run: python mycelium/signal_tracker.py
        continue-on-error: true
      - name: Step 2 â€” Loop Brain
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
        run: python mycelium/loop_brain.py
        continue-on-error: true
      - name: Step 3 â€” Humanitarian Content
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
          MASTODON_TOKEN: ${{ secrets.MASTODON_TOKEN }}
          MASTODON_URL: ${{ secrets.MASTODON_URL }}
          MASTODON_BASE_URL: ${{ secrets.MASTODON_BASE_URL }}
          BLUESKY_HANDLE: ${{ secrets.BLUESKY_HANDLE }}
          BLUESKY_APP_PASSWORD: ${{ secrets.BLUESKY_APP_PASSWORD }}
        run: python mycelium/humanitarian_content.py
        continue-on-error: true
      - name: Commit
        run: |
          git add data/ content/ || true
          git diff --cached --quiet && echo 'Nothing to commit' || (
            git commit -m "ðŸ”„ feedback loop [$(date -u +%Y-%m-%d)]" &&
            git pull --rebase origin main &&
            git push origin main
          )
        continue-on-error: true
